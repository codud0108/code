import streamlit as st

# --- ëª¨ìŠ¤ ë¶€í˜¸ ë°ì´í„° ---
# í•œê¸€(ìëª¨), ìˆ«ì, ì˜ë¬¸ì— ëŒ€í•œ ëª¨ìŠ¤ ë¶€í˜¸ ì‚¬ì „
MORSE_CODE_DICT = {
    # í•œê¸€ ììŒ
    'ã„±': '.-..', 'ã„´': '--.', 'ã„·': '-..', 'ã„¹': '...-', 'ã…': '--', 'ã…‚': '.--', 
    'ã……': '--.-', 'ã…‡': '-.-', 'ã…ˆ': '.--.', 'ã…Š': '-.-.', 'ã…‹': '-..-', 'ã…Œ': '--..', 
    'ã…': '.---', 'ã…': '....',
    # í•œê¸€ ëœì†Œë¦¬
    'ã„²': '.-..-.', 'ã„¸': '-....', 'ã…ƒ': '.--.--', 'ã…†': '--.--', 'ã…‰': '.--..-.',
    # í•œê¸€ ëª¨ìŒ
    'ã…': '.', 'ã…‘': '..', 'ã…“': '-', 'ã…•': '...', 'ã…—': '.-', 'ã…›': '.-.', 
    'ã…œ': '..-', 'ã… ': '..-.', 'ã…¡': '-.--', 'ã…£': '.-.',
    # í•œê¸€ ì´ì¤‘ëª¨ìŒ
    'ã…': '.-.-', 'ã…”': '-...-', 'ã…š': '.-..-', 'ã…Ÿ': '..--', 'ã…¢': '-..-', 'ã…’': '..--.', 'ã…–': '...-',

    # ì˜ë¬¸ ì•ŒíŒŒë²³
    'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.',
    'G': '--.', 'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..',
    'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.',
    'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-',
    'Y': '-.--', 'Z': '--..',
    # ìˆ«ì
    '1': '.----', '2': '..---', '3': '...--', '4': '....-', '5': '.....',
    '6': '-....', '7': '--...', '8': '---..', '9': '----.', '0': '-----',
    # ë¬¸ì¥ ë¶€í˜¸ (ì¼ë¶€)
    '.': '.-.-.-', ',': '--..--', '?': '..--..', "'": '.----.', '!': '-.-.--',
    '/': '-..-.', '(': '-.--.', ')': '-.--.-', '&': '.-...', ':': '---...',
    ';': '-.-.-.', '=': '-...-', '+': '.-.-.', '-': '-....-', '_': '..--.-',
    '"': '.-..-.', '$': '...-..-', '@': '.--.-.',
}

# ëª¨ìŠ¤ ë¶€í˜¸ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•˜ê¸° ìœ„í•œ ì—­ ì‚¬ì „
# ì‚¬ìš©ìê°€ ìš”ì²­í•œ '_'ë¥¼ '-'ë¡œ ë‚´ë¶€ ë³€í™˜í•˜ì—¬ ì²˜ë¦¬
REVERSE_MORSE_DICT = {v: k for k, v in MORSE_CODE_DICT.items()}


# --- í•œê¸€ ë¶„í•´ë¥¼ ìœ„í•œ ë°ì´í„° ---
CHOSEONG_LIST = ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…']
JUNGSEONG_LIST = ['ã…', 'ã…', 'ã…‘', 'ã…’', 'ã…“', 'ã…”', 'ã…•', 'ã…–', 'ã…—', 'ã…˜', 'ã…™', 'ã…š', 'ã…›', 'ã…œ', 'ã…', 'ã…', 'ã…Ÿ', 'ã… ', 'ã…¡', 'ã…¢', 'ã…£']
JONGSEONG_LIST = [
    '', 'ã„±', 'ã„²', 'ã„³', 'ã„´', 'ã„µ', 'ã„¶', 'ã„·', 'ã„¹', 'ã„º', 'ã„»', 'ã„¼', 'ã„½', 'ã„¾', 'ã„¿', 'ã…€', 
    'ã…', 'ã…‚', 'ã…„', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'
]

# MORSE_CODE_DICTì— ì—†ëŠ” ë³µì¡í•œ ìëª¨ ë¶„í•´ ì‚¬ì „
COMPLEX_JAMO_DICT = {
    # ë³µí•© ëª¨ìŒ
    'ã…˜': 'ã…—ã…', 'ã…™': 'ã…—ã…', 'ã…': 'ã…œã…“', 'ã…': 'ã…œã…”',
    # ë³µí•© ììŒ (ë°›ì¹¨)
    'ã„³': 'ã„±ã……', 'ã„µ': 'ã„´ã…ˆ', 'ã„¶': 'ã„´ã…', 'ã„º': 'ã„¹ã„±', 'ã„»': 'ã„¹ã…', 'ã„¼': 'ã„¹ã…‚',
    'ã„½': 'ã„¹ã……', 'ã„¾': 'ã„¹ã…Œ', 'ã„¿': 'ã„¹ã…', 'ã…€': 'ã„¹ã…', 'ã…„': 'ã…‚ã……'
}

def decompose_hangul(char):
    """
    í•œê¸€ í•œ ê¸€ìë¥¼ ììŒ/ëª¨ìŒìœ¼ë¡œ ë¶„í•´í•©ë‹ˆë‹¤.
    (ì˜ˆ: 'ì•ˆ' -> 'ã…‡ã…ã„´', 'ì‚¶' -> 'ã……ã…ã„¹ã…')
    """
    code = ord(char)
    
    # 1. í•œê¸€ ìŒì ˆ ë²”ìœ„ (ê°€-í£)ì¸ì§€ í™•ì¸
    if 0xAC00 <= code <= 0xD7A3:
        code -= 0xAC00
        
        jongseong_index = code % 28
        code //= 28
        jungseong_index = code % 21
        code //= 21
        choseong_index = code
        
        ch = CHOSEONG_LIST[choseong_index]
        ju = JUNGSEONG_LIST[jungseong_index]
        jo = JONGSEONG_LIST[jongseong_index]
        
        # 2. ë³µì¡í•œ ìëª¨(ì‚¬ì „ì— ì—†ëŠ” ê²ƒ) ë¶„í•´
        if ju in COMPLEX_JAMO_DICT:
            ju = COMPLEX_JAMO_DICT[ju]
        if jo in COMPLEX_JAMO_DICT:
            jo = COMPLEX_JAMO_DICT[jo]
            
        return ch + ju + jo
        
    # 2. í•œê¸€ ìëª¨ ë²”ìœ„ (ã„±-ã…£)ì¸ì§€ í™•ì¸
    elif 'ã„±' <= char <= 'ã…£':
        if char in COMPLEX_JAMO_DICT:
            return COMPLEX_JAMO_DICT[char]
        else:
            return char
            
    # 3. í•œê¸€ì´ ì•„ë‹Œ ê²½ìš°
    else:
        return char

# --- ëª¨ìŠ¤ ë¶€í˜¸ ë³€í™˜ í•¨ìˆ˜ ---

def text_to_morse(text):
    """í…ìŠ¤íŠ¸ë¥¼ ëª¨ìŠ¤ ë¶€í˜¸ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. í•œê¸€ ìë™ ë¶„í•´ ê¸°ëŠ¥ ì¶”ê°€."""
    morse_code = []
    
    decomposed_text = ""
    for char in text:
        # ì…ë ¥ëœ ê¸€ìë¥¼ ìëª¨ ë‹¨ìœ„ë¡œ ë¶„í•´
        decomposed_text += decompose_hangul(char)
        
    # ë¶„í•´ëœ ìëª¨ë¥¼ í•˜ë‚˜ì”© ëª¨ìŠ¤ ë¶€í˜¸ë¡œ ë³€í™˜
    for char in decomposed_text:
        upper_char = char.upper()
        if upper_char in MORSE_CODE_DICT:
            # '-'ë¥¼ '_'ë¡œ ë³€í™˜í•˜ì—¬ ì¶”ê°€
            morse_code.append(MORSE_CODE_DICT[upper_char].replace('-', '_'))
        elif upper_char == ' ':
            # ë„ì–´ì“°ê¸°(ë‹¨ì–´ êµ¬ë¶„)ëŠ” ' / 'ë¡œ í‘œì‹œ
            morse_code.append('/')
        else:
            # ì‚¬ì „ì— ì—†ëŠ” ë¬¸ìëŠ” '?'ë¡œ í‘œì‹œ
            morse_code.append('?')
    
    # ê° ëª¨ìŠ¤ ë¶€í˜¸ ì‚¬ì´ëŠ” ë„ì–´ì“°ê¸° í•œ ì¹¸ìœ¼ë¡œ êµ¬ë¶„
    return ' '.join(morse_code)

def morse_to_text(morse_input):
    """ëª¨ìŠ¤ ë¶€í˜¸ë¥¼ í…ìŠ¤íŠ¸ë¡œ ë³€í™˜í•©ë‹ˆë‹¤. '_' ì…ë ¥ì„ ì§€ì›í•©ë‹ˆë‹¤."""
    # ì‚¬ìš©ìê°€ ì…ë ¥í•œ '_'ë¥¼ ë‚´ë¶€ì—ì„œ ì‚¬ìš©í•˜ëŠ” '-'ë¡œ ë‹¤ì‹œ ë³€í™˜
    morse_input_normalized = morse_input.replace('_', '-')
    
    # ' / 'ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‹¨ì–´ ë¶„ë¦¬
    words = morse_input_normalized.split(' / ')
    decoded_text = []
    
    for word in words:
        # ë„ì–´ì“°ê¸° í•œ ì¹¸ì„ ê¸°ì¤€ìœ¼ë¡œ ë¬¸ì(ìëª¨) ë¶„ë¦¬
        letters = word.split(' ')
        decoded_word = ''
        for letter in letters:
            if letter in REVERSE_MORSE_DICT:
                decoded_word += REVERSE_MORSE_DICT[letter]
            elif letter == '':
                continue # ì—°ì†ëœ ê³µë°± ë¬´ì‹œ
            else:
                decoded_word += '?' # ì‚¬ì „ì— ì—†ëŠ” ë¶€í˜¸
        decoded_text.append(decoded_word)
        
    # ë‹¨ì–´ ì‚¬ì´ëŠ” ë„ì–´ì“°ê¸°ë¡œ í•©ì¹¨
    return ' '.join(decoded_text)


# --- ì¹´ì´ì‚¬ë¥´ ì•”í˜¸ ë³€í™˜ í•¨ìˆ˜ ---

def caesar_cipher(text, shift, mode):
    """
    í…ìŠ¤íŠ¸ì— ëŒ€í•´ ì¹´ì´ì‚¬ë¥´ ì•”í˜¸ë¥¼ ì ìš©í•©ë‹ˆë‹¤.
    mode: 'encrypt' (ì•”í˜¸í™”) ë˜ëŠ” 'decrypt' (ë³µí˜¸í™”)
    shift: 1-25 ì‚¬ì´ì˜ ì •ìˆ˜
    """
    result = ""
    
    if mode == 'decrypt':
        shift = -shift
        
    for char in text:
        # ì˜ë¬¸ ëŒ€ë¬¸ìì¸ ê²½ìš°
        if 'A' <= char <= 'Z':
            new_ord = (ord(char) - ord('A') + shift) % 26 + ord('A')
            result += chr(new_ord)
        # ì˜ë¬¸ ì†Œë¬¸ìì¸ ê²½ìš°
        elif 'a' <= char <= 'z':
            new_ord = (ord(char) - ord('a') + shift) % 26 + ord('a')
            result += chr(new_ord)
        # ì˜ë¬¸ì´ ì•„ë‹Œ ê²½ìš° (í•œê¸€, ìˆ«ì, ê¸°í˜¸ ë“±) ê·¸ëŒ€ë¡œ ìœ ì§€
        else:
            result += char
            
    return result


# --- Streamlit ì•± UI êµ¬ì„± ---

def main():
    st.sidebar.title("ì•”í˜¸ ë³€í™˜ê¸°")
    page = st.sidebar.radio("ë©”ë‰´ ì„ íƒ", ["ì•± ì„¤ëª…", "ëª¨ìŠ¤ ë¶€í˜¸ ë³€í™˜ê¸°", "ì¹´ì´ì‚¬ë¥´ ì•”í˜¸ ë³€í™˜ê¸°"])

    if page == "ì•± ì„¤ëª…":
        st.title("ğŸ’¡ ëª¨ìŠ¤ ë¶€í˜¸ & ì¹´ì´ì‚¬ë¥´ ì•”í˜¸ ë³€í™˜ê¸°")
        st.markdown("""
        í™˜ì˜í•©ë‹ˆë‹¤! ì´ ì•±ì€ ë‘ ê°€ì§€ ê³ ì „ì ì¸ ì•”í˜¸ ë°©ì‹ì„ ì²´í—˜í•  ìˆ˜ ìˆëŠ” **ëª¨ìŠ¤ ë¶€í˜¸ & ì¹´ì´ì‚¬ë¥´ ì•”í˜¸ ë³€í™˜ê¸°**ì…ë‹ˆë‹¤.

        ì™¼ìª½ ì‚¬ì´ë“œë°”ì—ì„œ ì›í•˜ëŠ” ì•”í˜¸ ë°©ì‹ì„ ì„ íƒí•˜ì„¸ìš”. í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ë©´ ì¦‰ì‹œ ëª¨ìŠ¤ ë¶€í˜¸ë‚˜ ì¹´ì´ì‚¬ë¥´ ì•”í˜¸ë¡œ ë³€í™˜í•´ ì£¼ë©°, ë°˜ëŒ€ë¡œ ì•”í˜¸ë¬¸ì„ í•´ë…í•˜ì—¬ ì›ë˜ í…ìŠ¤íŠ¸ë¥¼ í™•ì¸í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

        ì´ ë„êµ¬ë¥¼ í†µí•´ ì•”í˜¸í•™ì˜ ê¸°ë³¸ ì›ë¦¬ë¥¼ ì¬ë¯¸ìˆê²Œ íƒìƒ‰í•´ ë³´ì„¸ìš”!
        """)

    elif page == "ëª¨ìŠ¤ ë¶€í˜¸ ë³€í™˜ê¸°":
        st.title("Morse ë¶€í˜¸ ë³€í™˜ê¸°")
        st.markdown("""
        ëª¨ìŠ¤ ë¶€í˜¸(Morse Code)ëŠ” ì§§ì€ ì‹ í˜¸(ì , `.` )ì™€ ê¸´ ì‹ í˜¸(ì„ , `_` )ë¥¼ ì¡°í•©í•˜ì—¬ ë¬¸ìë¥¼ ë‚˜íƒ€ë‚´ëŠ” í†µì‹  ë°©ì‹ì…ë‹ˆë‹¤. 
        ê°€ì¥ ìœ ëª…í•œ ì‹ í˜¸ëŠ” êµ­ì œ ì¡°ë‚œ ì‹ í˜¸ì¸ **'SOS' (`... ___ ...`)**ì…ë‹ˆë‹¤.
        """)
        
        st.info("ì™„ì„±ëœ í•œê¸€('ì•ˆë…•')ì„ ì…ë ¥í•˜ë©´ ììŒ/ëª¨ìŒ('ã…‡ã…ã„´ã„´ã…•ã…‡')ìœ¼ë¡œ ìë™ ë¶„í•´ë˜ì–´ ë³€í™˜ë©ë‹ˆë‹¤.")

        # í…ìŠ¤íŠ¸ -> ëª¨ìŠ¤ ë¶€í˜¸
        st.subheader("í…ìŠ¤íŠ¸ â†’ ëª¨ìŠ¤ ë¶€í˜¸")
        text_in = st.text_area("í•œê¸€, ì˜ë¬¸, ìˆ«ì ì…ë ¥:", key="text_to_morse_in")
        if st.button("ëª¨ìŠ¤ ë¶€í˜¸ë¡œ ë³€í™˜", key="btn_text_to_morse"):
            if text_in:
                morse_out = text_to_morse(text_in)
                st.code(morse_out)
            else:
                st.warning("ë³€í™˜í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.")

        # ëª¨ìŠ¤ ë¶€í˜¸ -> í…ìŠ¤íŠ¸
        st.subheader("ëª¨ìŠ¤ ë¶€í˜¸ â†’ í…ìŠ¤íŠ¸")
        morse_in = st.text_area("ëª¨ìŠ¤ ë¶€í˜¸ ì…ë ¥ ( . / _ ì‚¬ìš© )", 
                                help="ë¬¸ì êµ¬ë¶„: ë„ì–´ì“°ê¸° 1ì¹¸ | ë‹¨ì–´ êµ¬ë¶„: ' / ' (ë„ì–´ì“°ê¸° í›„ / ë„ì–´ì“°ê¸°)",
                                key="morse_to_text_in")
        if st.button("í…ìŠ¤íŠ¸ë¡œ ë³€í™˜", key="btn_morse_to_text"):
            if morse_in:
                text_out = morse_to_text(morse_in)
                st.text_area("ë³€í™˜ ê²°ê³¼:", value=text_out, height=100, disabled=True)
            else:
                st.warning("ë³€í™˜í•  ëª¨ìŠ¤ ë¶€í˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.")

    elif page == "ì¹´ì´ì‚¬ë¥´ ì•”í˜¸ ë³€í™˜ê¸°":
        st.title("ğŸ›ï¸ ì¹´ì´ì‚¬ë¥´ ì•”í˜¸ ë³€í™˜ê¸°")
        st.markdown("""
        ì¹´ì´ì‚¬ë¥´ ì•”í˜¸(Caesar Cipher)ëŠ” ê°€ì¥ ê°„ë‹¨í•œ **ì¹˜í™˜ ì•”í˜¸** ë°©ì‹ ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤.
        ì•ŒíŒŒë²³ì˜ ê° ë¬¸ìë¥¼ **ì¼ì •í•œ ê±°ë¦¬(í‚¤ ê°’)**ë§Œí¼ ë°€ì–´ì„œ ë‹¤ë¥¸ ë¬¸ìë¡œ ë°”ê¿‰ë‹ˆë‹¤.
        
        * **ì˜ˆì‹œ (í‚¤ = 3):** 'HELLO' â†’ 'KHOOR'
        """)
        st.info("ì¹´ì´ì‚¬ë¥´ ì•”í˜¸ëŠ” ì˜ë¬¸ì(A-Z, a-z)ë§Œ ë³€í™˜í•©ë‹ˆë‹¤. í•œê¸€, ìˆ«ì, ê¸°í˜¸ëŠ” ë³€í™˜ë˜ì§€ ì•Šê³  ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.")

        # í‚¤ ê°’ ì…ë ¥ì„ ìœ„í•œ ìŠ¬ë¼ì´ë”
        shift_key = st.slider("í‚¤(Key) ì„ íƒ (ì–¼ë§ˆë‚˜ ë°€ì§€ ê²°ì •):", min_value=1, max_value=25, value=3)
        
        text_in_caesar = st.text_area("ì•”í˜¸í™” ë˜ëŠ” ë³µí˜¸í™”í•  í…ìŠ¤íŠ¸ ì…ë ¥:", key="caesar_text")
        
        col1, col2 = st.columns(2)
        
        with col1:
            if st.button("ì•”í˜¸í™”í•˜ê¸°", key="btn_encrypt"):
                if text_in_caesar:
                    encrypted_text = caesar_cipher(text_in_caesar, shift_key, 'encrypt')
                    st.text_area("ì•”í˜¸í™” ê²°ê³¼:", value=encrypted_text, height=150, disabled=True, key="caesar_out_encrypt")
                else:
                    st.warning("ì•”í˜¸í™”í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
                    
        with col2:
            if st.button("ë³µí˜¸í™”í•˜ê¸°", key="btn_decrypt"):
                if text_in_caesar:
                    decrypted_text = caesar_cipher(text_in_caesar, shift_key, 'decrypt')
                    st.text_area("ë³µí˜¸í™” ê²°ê³¼:", value=decrypted_text, height=150, disabled=True, key="caesar_out_decrypt")
                else:
                    st.warning("ë³µí˜¸í™”í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.")

if __name__ == "__main__":
    main()
